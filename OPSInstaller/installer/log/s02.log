+ intype=full
+ full=full
+ echo 'create new public-private keys'
create new public-private keys
+ rm '/home/openstack/.ssh/*'
rm: cannot remove '/home/openstack/.ssh/*': No such file or directory
+ ./expectssh-keygen.sh
spawn ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/openstack/.ssh/id_rsa): 
Created directory '/home/openstack/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/openstack/.ssh/id_rsa.
Your public key has been saved in /home/openstack/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:sGRwr0Ojnor3bG3H3w89Cxks3JX86ECgESLYJqlyk4k openstack@controller
The key's randomart image is:
+---[RSA 2048]----+
|   +o o o..      |
|  + o+ o o . . . |
| o =  * o   . +  |
|E =  = = . + . o |
|.. .. + S o = . .|
|   . . .   . *   |
|    o. .    + +  |
| ..o. o o  . o o |
|...oo. . .. ..o  |
+----[SHA256]-----+
+ echo 'accept host keys'
accept host keys
+ ./expectsshyesno.sh openstack controller
spawn ssh -q openstack@controller
The authenticity of host 'controller (10.0.0.11)' can't be established.
ECDSA key fingerprint is SHA256:7VjfwjkewdJbC1cBfOyG2cMZIZzBsQLz+0sQVkMjMhQ.
Are you sure you want to continue connecting (yes/no)? yes
openstack@controller's password: + ./expectsshyesno.sh openstack network
spawn ssh -q openstack@network
The authenticity of host 'network (10.0.0.21)' can't be established.
ECDSA key fingerprint is SHA256:4tvxttr1KxsabLCJ+9PpN4gG5Q15FicWVyZ2X4HwGdc.
Are you sure you want to continue connecting (yes/no)? yes
openstack@network's password: + ./expectsshyesno.sh openstack compute
spawn ssh -q openstack@compute
The authenticity of host 'compute (10.0.0.31)' can't be established.
ECDSA key fingerprint is SHA256:4tvxttr1KxsabLCJ+9PpN4gG5Q15FicWVyZ2X4HwGdc.
Are you sure you want to continue connecting (yes/no)? yes
openstack@compute's password: + '[' full == full ']'
+ ./expectsshyesno.sh openstack compute1
spawn ssh -q openstack@compute1
The authenticity of host 'compute1 (10.0.0.32)' can't be established.
ECDSA key fingerprint is SHA256:4tvxttr1KxsabLCJ+9PpN4gG5Q15FicWVyZ2X4HwGdc.
Are you sure you want to continue connecting (yes/no)? yes
openstack@compute1's password: + echo 'propagate credentials'
propagate credentials
+ sshpass -popenstack scp /home/openstack/.ssh/id_rsa.pub openstack@controller:/home/openstack/authorized_keys
+ sshpass -popenstack scp /home/openstack/.ssh/id_rsa.pub openstack@network:/home/openstack/authorized_keys
+ sshpass -popenstack scp /home/openstack/.ssh/id_rsa.pub openstack@compute:/home/openstack/authorized_keys
+ '[' full == full ']'
+ sshpass -popenstack scp /home/openstack/.ssh/id_rsa.pub openstack@compute1:/home/openstack/authorized_keys
+ sshpass -popenstack ssh openstack@controller '(mkdir /home/openstack/.ssh; mv /home/openstack/authorized_keys /home/openstack/.ssh/authorized_keys)'
mkdir: cannot create directory ‘/home/openstack/.ssh’: File exists
+ sshpass -popenstack ssh openstack@network '(mkdir /home/openstack/.ssh; mv /home/openstack/authorized_keys /home/openstack/.ssh/authorized_keys)'
+ sshpass -popenstack ssh openstack@compute '(mkdir /home/openstack/.ssh; mv /home/openstack/authorized_keys /home/openstack/.ssh/authorized_keys)'
+ '[' full == full ']'
+ sshpass -popenstack ssh openstack@compute1 '(mkdir /home/openstack/.ssh; mv /home/openstack/authorized_keys /home/openstack/.ssh/authorized_keys)'
+ echo 'check date time of controller network compute'
check date time of controller network compute
+ ssh openstack@controller date
Wed Jun 13 15:56:51 +07 2018
+ ssh openstack@network date
Wed Jun 13 15:56:52 +07 2018
+ ssh openstack@compute date
Wed Jun 13 15:56:52 +07 2018
+ '[' full == full ']'
+ ssh openstack@compute1 date
Wed Jun 13 15:56:53 +07 2018
+ echo 'set sudoers'
set sudoers
+ sshpass -popenstack scp files/adjustsudoer.sh openstack@controller:/home/openstack/adjustsudoer.sh
+ sshpass -popenstack scp files/adjustsudoer.sh openstack@network:/home/openstack/adjustsudoer.sh
+ sshpass -popenstack scp files/adjustsudoer.sh openstack@compute:/home/openstack/adjustsudoer.sh
+ '[' full == full ']'
+ sshpass -popenstack scp files/adjustsudoer.sh openstack@compute1:/home/openstack/adjustsudoer.sh
+ ./expectsetsudoer.sh openstack controller openstack
spawn ssh -t openstack@controller sudo /home/openstack/adjustsudoer.sh
Connection to controller closed.
send: spawn id exp4 not open
    while executing
"send "$argv3\r""
    (file "./expectsetsudoer.sh" line 15)
+ ./expectsetsudoer.sh openstack network openstack
spawn ssh -t openstack@network sudo /home/openstack/adjustsudoer.sh
Connection to network closed.
send: spawn id exp4 not open
    while executing
"send "$argv3\r""
    (file "./expectsetsudoer.sh" line 15)
+ ./expectsetsudoer.sh openstack compute openstack
spawn ssh -t openstack@compute sudo /home/openstack/adjustsudoer.sh
Connection to compute closed.
send: spawn id exp4 not open
    while executing
"send "$argv3\r""
    (file "./expectsetsudoer.sh" line 15)
+ '[' full == full ']'
+ ./expectsetsudoer.sh openstack compute1 openstack
spawn ssh -t openstack@compute1 sudo /home/openstack/adjustsudoer.sh
Connection to compute1 closed.
send: spawn id exp4 not open
    while executing
"send "$argv3\r""
    (file "./expectsetsudoer.sh" line 15)
+ echo 'set timezone of controller network compute'
set timezone of controller network compute
+ ssh -t openstack@controller sudo timedatectl set-timezone Asia/Bangkok
Connection to controller closed.
+ ssh -t openstack@network sudo timedatectl set-timezone Asia/Bangkok
Connection to network closed.
+ ssh -t openstack@compute sudo timedatectl set-timezone Asia/Bangkok
Connection to compute closed.
+ '[' full == full ']'
+ ssh -t openstack@compute1 sudo timedatectl set-timezone Asia/Bangkok
Connection to compute1 closed.
+ echo 'set date of controller network compute'
set date of controller network compute
++ date
+ ssh -t openstack@controller sudo date '--set="Wed' Jun 13 15:56:57 +07 '2018"'
Wed Jun 13 15:56:57 +07 2018
Connection to controller closed.
++ date
+ ssh -t openstack@network sudo date '--set="Wed' Jun 13 15:56:57 +07 '2018"'
Wed Jun 13 15:56:57 +07 2018
Connection to network closed.
++ date
+ ssh -t openstack@compute sudo date '--set="Wed' Jun 13 15:56:58 +07 '2018"'
Wed Jun 13 15:56:58 +07 2018
Connection to compute closed.
+ '[' full == full ']'
++ date
+ ssh -t openstack@compute1 sudo date '--set="Wed' Jun 13 15:56:58 +07 '2018"'
Wed Jun 13 15:56:58 +07 2018
Connection to compute1 closed.
